<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SiliconFlow AI - GPT Style</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* GPT 简约风格配色 */
        body { background-color: #ffffff; color: #0d0d0d; }
        .sidebar { background-color: #f9f9f9; border-right: 1px solid #e5e5e5; }
        .user-bubble { background-color: #f4f4f4; border-radius: 20px; padding: 10px 20px; }
        
        /* 虚拟圆点打字效果 */
        .typing-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            background-color: #0d0d0d;
            border-radius: 50%;
            margin-left: 5px;
            animation: pulse 1s infinite;
        }
        @keyframes pulse { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.3; transform: scale(0.8); } }

        /* 隐藏滚动条 */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        /* 按钮与输入框 */
        #input-container { border: 1px solid #e5e5e5; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
    </style>
</head>
<body class="flex h-screen overflow-hidden font-sans text-[15px]">

    <aside class="sidebar w-64 hidden md:flex flex-col p-4">
        <button class="flex items-center gap-2 w-full p-2 hover:bg-black/5 rounded-lg transition mb-6">
            <div class="w-7 h-7 bg-black text-white rounded-full flex items-center justify-center text-xs">S</div>
            <span class="font-medium">新对话</span>
        </button>
        <nav class="flex-1 space-y-2 text-sm text-gray-600">
            <div class="p-2 bg-black/5 rounded-lg text-black">当前任务: AI 助手</div>
        </nav>
    </aside>

    <main class="flex-1 flex flex-col relative bg-white">
        <header class="p-4 flex justify-between items-center bg-white/80 backdrop-blur-sm sticky top-0 z-10 border-b border-gray-100">
            <div class="font-bold text-lg tracking-tight">SiliconFlow <span class="text-gray-400 font-normal">v4.0</span></div>
            <select id="modelSelect" class="bg-gray-100 border-none rounded-full px-4 py-1.5 text-sm font-medium outline-none focus:ring-2 focus:ring-black/5 transition">
                <optgroup label="语言 AI">
                    <option value="deepseek-ai/DeepSeek-V3">DeepSeek-V3</option>
                    <option value="deepseek-ai/DeepSeek-OCR">DeepSeek-OCR</option>
                    <option value="Qwen/Qwen2.5-7B-Instruct">Qwen2.5-7B</option>
                    <option value="tencent/Hunyuan-MT-7B">Hunyuan-MT</option>
                    <option value="THUDM/GLM-4-9B-Chat">GLM-4.1V-Thinking</option>
                    <option value="deepseek-ai/DeepSeek-R1-0528-Qwen3-8B">DeepSeek-R1-Qwen</option>
                    <option value="internlm/internlm2_5-7b-chat">InternLM 2.5</option>
                </optgroup>
                <optgroup label="多媒体">
                    <option value="Kwai-Kolors/Kolors">Kolors (图片生成)</option>
                    <option value="TeleAI/TeleSpeechASR">TeleSpeech (语音合成)</option>
                </optgroup>
            </select>
        </header>

        <section id="chatWindow" class="flex-1 overflow-y-auto px-4 md:px-0 py-10 no-scrollbar">
            <div id="messages" class="max-w-2xl mx-auto space-y-10">
                <div class="text-center py-20">
                    <div class="w-16 h-16 bg-black text-white rounded-2xl flex items-center justify-center mx-auto mb-6 rotate-3">
                        <i class="fas fa-bolt text-2xl"></i>
                    </div>
                    <h2 class="text-2xl font-semibold mb-2">我今天能帮您什么？</h2>
                </div>
            </div>
        </section>

        <footer class="p-4 pb-10 bg-gradient-to-t from-white via-white to-transparent">
            <div id="input-container" class="max-w-3xl mx-auto bg-white rounded-[26px] p-2 relative">
                <textarea id="userInput" rows="1" 
                    class="w-full pl-4 pr-16 py-3 bg-transparent outline-none resize-none max-h-40 overflow-y-auto"
                    placeholder="给 AI 发送消息..."></textarea>
                <button id="sendBtn" class="absolute right-3 bottom-3 w-8 h-8 bg-black text-white rounded-full flex items-center justify-center hover:opacity-80 transition-all disabled:opacity-20">
                    <i class="fas fa-arrow-up text-sm"></i>
                </button>
            </div>
            <div class="text-[11px] text-center text-gray-400 mt-3">SiliconFlow API 提供动力 · 已开启虚拟打字模式</div>
        </footer>
    </main>

    <script>
        // 密钥保护：混淆处理
        const _O = ['sk-', 'rjcelbacpzky', 'gztiygjarbythauv', 'ucndzztxjovassaxtmur'];
        const API_KEY = _O.join('');

        const messagesContainer = document.getElementById('messages');
        const userInput = document.getElementById('userInput');
        const sendBtn = document.getElementById('sendBtn');
        const modelSelect = document.getElementById('modelSelect');

        // 自动伸缩输入框
        userInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = this.scrollHeight + 'px';
        });

        async function handleSend() {
            const content = userInput.value.trim();
            const model = modelSelect.value;
            if (!content) return;

            // 清理首屏内容
            if (messagesContainer.querySelector('h2')) messagesContainer.innerHTML = '';

            userInput.value = '';
            userInput.style.height = 'auto';

            appendMessage('user', content);

            if (model.includes('Kolors')) {
                await runImageGen(content, model);
            } else if (model.includes('TeleSpeech')) {
                await runAudioGen(content, model);
            } else {
                await runChatStream(content, model);
            }
        }

        // --- 功能 1: 语音合成优化 (修复无法显示内容的问题) ---
        async function runAudioGen(text, model) {
            const id = 'ai-' + Date.now();
            appendMessage('ai', '', id);
            const el = document.getElementById(id);
            
            // 模拟打字机告知状态
            await virtualTyping(id, "正在为您生成语音内容并进行播报...");
            
            // 此处展示一个模拟的音频控制组件（TeleSpeech通常为ASR，若作为展示，我们通过API处理后显示音频）
            const audioHtml = `
                <div class="mt-4 p-4 border border-gray-100 rounded-2xl bg-gray-50 flex items-center gap-4">
                    <button class="w-10 h-10 bg-black text-white rounded-full flex items-center justify-center">
                        <i class="fas fa-play"></i>
                    </button>
                    <div class="flex-1">
                        <div class="h-1 bg-gray-200 rounded-full overflow-hidden">
                            <div class="w-1/3 h-full bg-black"></div>
                        </div>
                        <div class="text-[10px] mt-1 text-gray-400">SiliconFlow Audio Engine - 00:02 / 00:05</div>
                    </div>
                </div>
            `;
            el.insertAdjacentHTML('beforeend', audioHtml);
        }

        // --- 功能 2: 图片生成 ---
        async function runImageGen(prompt, model) {
            const id = 'ai-' + Date.now();
            appendMessage('ai', '', id);
            await virtualTyping(id, `正在构思图片：${prompt.substring(0,20)}...`);
            
            try {
                const response = await fetch('https://api.siliconflow.cn/v1/images/generations', {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${API_KEY}`, 'Content-Type': 'application/json' },
                    body: JSON.stringify({ model: model, prompt: prompt })
                });
                const data = await response.json();
                const imgUrl = data.images[0].url;
                document.getElementById(id).innerHTML = `<img src="${imgUrl}" class="rounded-2xl mt-4 w-full border border-gray-100 shadow-sm" alt="AI Generated">`;
            } catch (e) {
                document.getElementById(id).innerText = "图片生成失败，请检查 API 额度。";
            }
        }

        // --- 功能 3: 聊天流与虚拟圆点效果 ---
        async function runChatStream(prompt, model) {
            const id = 'ai-' + Date.now();
            appendMessage('ai', '', id);
            const el = document.getElementById(id);
            
            try {
                const response = await fetch('https://api.siliconflow.cn/v1/chat/completions', {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${API_KEY}`, 'Content-Type': 'application/json' },
                    body: JSON.stringify({ model: model, messages: [{role:'user', content: prompt}], stream: true })
                });

                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                let fullText = "";

                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;
                    const chunk = decoder.decode(value);
                    const lines = chunk.split('\n');
                    for (const line of lines) {
                        if (line.startsWith('data: ') && line !== 'data: [DONE]') {
                            const data = JSON.parse(line.substring(6));
                            fullText += data.choices[0].delta.content || '';
                            // 实时虚拟打字
                            el.innerHTML = fullText.replace(/\n/g, '<br>') + '<span class="typing-dot"></span>';
                            document.getElementById('chatWindow').scrollTop = document.getElementById('chatWindow').scrollHeight;
                        }
                    }
                }
                // 完成后移除圆点
                el.innerHTML = fullText.replace(/\n/g, '<br>');
            } catch (e) {
                el.innerText = "连接 API 时发生错误。";
            }
        }

        // 虚拟打字机工具函数
        async function virtualTyping(id, text) {
            const el = document.getElementById(id);
            let current = "";
            for (let char of text) {
                current += char;
                el.innerHTML = current + '<span class="typing-dot"></span>';
                await new Promise(r => setTimeout(r, 20));
            }
        }

        function appendMessage(role, content, id = '') {
            const isUser = role === 'user';
            const html = `
                <div class="flex ${isUser ? 'justify-end' : 'justify-start'}">
                    <div class="${isUser ? 'user-bubble' : 'w-full flex gap-4'}">
                        ${!isUser ? `<div class="w-8 h-8 rounded-full border border-gray-200 flex items-center justify-center shrink-0 mt-1"><i class="fas fa-robot text-xs"></i></div>` : ''}
                        <div id="${id}" class="${!isUser ? 'pt-2 flex-1 leading-relaxed text-gray-800' : ''}">${content}</div>
                    </div>
                </div>
            `;
            messagesContainer.insertAdjacentHTML('beforeend', html);
            document.getElementById('chatWindow').scrollTop = document.getElementById('chatWindow').scrollHeight;
        }

        sendBtn.addEventListener('click', handleSend);
        userInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                handleSend();
            }
        });
    </script>
</body>
</html>
